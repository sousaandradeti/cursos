<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Confirmaﾃｧﾃ｣o de Curso</title>

<style>
    body { font-family: Arial, sans-serif; background:#f7f7f7; padding:40px; transition: all 0.5s ease; }
    
    .box { 
        background:white; 
        max-width:400px; 
        margin:auto; 
        padding: 30px 40px;
        border-radius:10px; 
        box-shadow:0 0 15px #00000025;
        box-sizing: border-box;
        transition: max-width 0.5s ease, width 0.5s ease;
    }
    
    h2 { text-align:center; margin-bottom: 25px; }
    
    input[type="text"], input[type="email"], button {
        width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 6px; 
        font-size: 16px; border: 1px solid #ccc; box-sizing: border-box;
    }
    
    button { 
        background:#0176ff; color:white; cursor:pointer; border:none;
        padding: 14px; margin-top: 20px; font-weight: bold; transition: background 0.2s;
    }
    button:hover { background:#005ad1; }
    
    /* Classe para esconder elementos com prioridade */
    .hidden { display: none !important; }

    /* Estilos da Avaliaﾃｧﾃ｣o */
    .rating-box { display: flex; justify-content: space-between; direction: rtl; margin: 15px 0 25px 0; }
    .rating-box input[type="radio"] { display: none; }
    .rating-box label { font-size: 40px; color: #ccc; cursor: pointer; position: relative; min-width: 45px; text-align: center; transition: transform 0.2s; }
    .rating-box label[for="star5"]::before { content: ''; }
    .rating-box label[for="star4"]::before { content: '凾'; }
    .rating-box label[for="star3"]::before { content: ''; }
    .rating-box label[for="star2"]::before { content: '凵'; }
    .rating-box label[for="star1"]::before { content: '丕'; } 
    .rating-box label:hover { transform: scale(1.1); }

    .rating-box input[type="radio"]:checked + label::after {
        content: '\2713'; position: absolute; bottom: -15px; left: 50%;
        transform: translateX(-50%); background-color: #28a745;
        color: white; font-size: 14px; padding: 3px 6px; border-radius: 50%;
    }
    
    .success-box { text-align: center; }
    #pdf-container { width: 100%; height: 750px; margin-top: 20px; border: 1px solid #ddd; border-radius: 8px; background: #eee; }

    .button-link {
        display: inline-block; width: 100%; padding: 14px; border-radius: 6px;
        font-size: 16px; font-weight: bold; text-align: center; text-decoration: none;
        background:#0176ff; color:white; margin-top: 20px; box-sizing: border-box;
    }
</style>
</head>
<body>

<div class="box success-box hidden" id="successBox">
    <h2 id="final-message-title">Processando...</h2>
    <p id="success-message"></p>
    <div id="pdf-container" class="hidden"></div>
    <a href="https://sousaandrade.sharepoint.com/" id="back-button" class="button-link hidden">Voltar para o Inﾃｭcio</a>
</div>

<div class="box main-box" id="mainBox">
    <h2>Sousa Andrade Academy</h2>
    <form id="submissionForm">
        <input type="hidden" id="scriptUrl" value="https://script.google.com/macros/s/AKfycbyxJcX4G0468ooL8qKWKZEUJgVFH2z9jtwbdNeDCht2Fnx_Y7MbWUEy9T-ZkCg_d9j5/exec">
        
        <input type="text" name="nome" placeholder="Seu nome" required>
        <input type="email" name="email" placeholder="Seu email" required>
        <input type="hidden" name="curso" id="curso">
        
        <div id="rating-section"> 
            <label id="course-label" style="margin-bottom: 10px; display: block; font-weight: bold;">Sua Avaliaﾃｧﾃ｣o do Curso:</label>
            <div class="rating-box">
                <input type="radio" id="star5" name="nota" value="5" required />
                <label for="star5" title="Excelente"></label>
                <input type="radio" id="star4" name="nota" value="4" />
                <label for="star4" title="Bom"></label>
                <input type="radio" id="star3" name="nota" value="3" />
                <label for="star3" title="Razoﾃ｡vel"></label>
                <input type="radio" id="star2" name="nota" value="2" />
                <label for="star2" title="Ruim"></label>
                <input type="radio" id="star1" name="nota" value="1" />
                <label for="star1" title="Muito Ruim"></label>
            </div>
        </div>

        <input type="hidden" name="status" id="status">
        <button type="submit" id="submitButton">Enviar</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const p = new URLSearchParams(window.location.search);
        const form = document.getElementById("submissionForm");
        const ratingSection = document.getElementById("rating-section"); 
        const statusValue = (p.get("status") || "").toLowerCase();
        const cursoValue = p.get("curso");

        // URL DE INCORPORAﾃﾃグ (EMBED) DO SHAREPOINT
        const EMBED_PDF_URL = "https://sousaandrade-my.sharepoint.com/personal/bruno_santos_sousaandrade_com_br/_layouts/15/embed.aspx?UniqueId=8421f155-cfad-4a15-8f24-162332d76d06";

        // CONFIGURAﾃﾃグ INICIAL BASEADA NO STATUS
        if (statusValue === "iniciado") {
            ratingSection.classList.add('hidden'); // Oculta avaliaﾃｧﾃ｣o
            document.querySelectorAll('input[name="nota"]').forEach(i => i.removeAttribute('required'));
            document.getElementById("submitButton").textContent = 'Iniciar Curso';
        } else {
            ratingSection.classList.remove('hidden');
            document.getElementById("submitButton").textContent = 'Concluir Avaliaﾃｧﾃ｣o';
        }

        if (cursoValue) {
            document.getElementById("curso").value = cursoValue;
            document.getElementById("course-label").textContent = `Avaliaﾃｧﾃ｣o: ${cursoValue.replace(/_/g, ' ')}`;
        }
        document.getElementById("status").value = statusValue;

        // SUBMISSﾃグ DO FORMULﾃヽIO
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const submitBtn = document.getElementById("submitButton");
            submitBtn.textContent = 'Registrando...';
            submitBtn.disabled = true;

            const scriptUrl = document.getElementById("scriptUrl").value;
            
            fetch(scriptUrl, { method: 'POST', body: new FormData(form) })
            .then(res => res.text())
            .then(data => {
                if (data.trim() === 'REGISTRO_OK') {
                    document.getElementById("mainBox").classList.add('hidden');
                    const successBox = document.getElementById("successBox");
                    successBox.classList.remove('hidden');

                    if (statusValue === "iniciado") {
                        document.getElementById("final-message-title").textContent = 'Acesso Liberado!';
                        let countdown = 3;
                        const msg = document.getElementById("success-message");
                        
                        const timer = setInterval(() => {
                            msg.innerHTML = `O fascﾃｭculo serﾃ｡ exibido em ${countdown} segundos...`;
                            if (countdown <= 0) {
                                clearInterval(timer);
                                msg.innerHTML = "Boa leitura! Use o botﾃ｣o abaixo ao finalizar.";
                                
                                // EXPANSﾃグ DA TELA PARA O PDF
                                successBox.style.maxWidth = '1000px'; 
                                successBox.style.width = '95%';
                                
                                const pdfCont = document.getElementById("pdf-container");
                                pdfCont.classList.remove('hidden');
                                pdfCont.innerHTML = `<iframe src="${EMBED_PDF_URL}" width="100%" height="750px" frameborder="0" scrolling="no" allowfullscreen></iframe>`;
                                
                                const backBtn = document.getElementById("back-button");
                                backBtn.classList.remove('hidden');
                                backBtn.textContent = "Concluir e Voltar";
                            }
                            countdown--;
                        }, 1000);
                    } else {
                        document.getElementById("final-message-title").textContent = '脂 Concluﾃｭdo!';
                        document.getElementById("success-message").textContent = 'Sua participaﾃｧﾃ｣o e avaliaﾃｧﾃ｣o foram registradas com sucesso.';
                        document.getElementById("back-button").classList.remove('hidden');
                    }
                } else {
                    alert("Erro ao registrar no banco de dados.");
                    submitBtn.disabled = false;
                }
            })
            .catch(err => {
                alert("Erro de conexﾃ｣o com o servidor.");
                submitBtn.disabled = false;
            });
        });
    });
</script>
</body>
</html>
