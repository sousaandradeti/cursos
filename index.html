<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Confirma칞칚o de Curso</title>

<style>
  /* Estilos de Layout Base */
  body { font-family: Arial, sans-serif; background:#f7f7f7; padding:40px; }
 먝
  .box {
    background:white;
    max-width:400px;
    margin:auto;
    padding: 30px 40px; 
    border-radius:10px;
    box-shadow:0 0 15px #00000025;
    box-sizing: border-box; 
  }
 먝
  h2 {
    text-align:center;
    margin-bottom: 25px;
  }
 먝
  /* Estilo para campos de input e bot칚o */
  input[type="text"], input[type="email"], button {
    width: 100%;
    padding: 12px;
    margin-top: 0;
    margin-bottom: 15px;
    border-radius: 6px;
    font-size: 16px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
 먝
  button {
    background:#0176ff;
    color:white;
    cursor:pointer;
    border:none;
    padding: 14px;
    margin-top: 20px;
    font-weight: bold;
    transition: background-color 0.2s;
  }
 먝
  button:hover {
    background:#005ad1;
  }
 먝
  .hidden {
    display: none !important;
  }

  /* --- Estilos para o Seletor de Emojis (Rating) --- */
  .rating-box {
    display: flex;
    justify-content: space-between;
    direction: rtl;
    margin: 15px 0 25px 0;
  }

  .rating-box input[type="radio"] {
    display: none;
  }

  .rating-box label {
    font-size: 40px;
    color: #ccc;
    cursor: pointer;
    padding: 0 2px;
    transition: color 0.2s, transform 0.2s;
    position: relative;
    min-width: 45px;
    text-align: center;
  }

  /* Define os emojis para cada ponto */
  .rating-box label[for="star5"]::before { content: '游'; }
  .rating-box label[for="star4"]::before { content: '游뗵'; }
  .rating-box label[for="star3"]::before { content: '游땛'; }
  .rating-box label[for="star2"]::before { content: '游뗴'; }
  .rating-box label[for="star1"]::before { content: '游땨'; }

  /* Efeito de hover e sele칞칚o */
  .rating-box label:hover,
  .rating-box label:hover ~ label,
  .rating-box input[type="radio"]:checked ~ label {
    color: #ffc107;
    transform: scale(1.1);
  }

  .rating-box input[type="radio"]:checked + label {
    color: #ff9800;
  }

  /* Estilo para o check de sele칞칚o */
  .rating-box input[type="radio"]:checked + label::after {
    content: '\2713';
    position: absolute;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #28a745;
    color: white;
    font-size: 14px;
    line-height: 1;
    padding: 3px 6px;
    border-radius: 50%;
    z-index: 10;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
 먝
  /* --- Estilos para a Mensagem de Sucesso e Redirecionamento --- */
  .success-box {
    text-align: center;
    padding: 50px 40px !important;
  }
  .success-box h2 {
    color: #28a745;
    margin-bottom: 10px;
  }
  .success-box p {
    margin-bottom: 25px;
    color: #555;
  }
  /* Novo estilo para a tela de Redirecionamento imediato */
  .redirect-box h2 {
    color: #0176ff;
  }

  .button-link {
    display: inline-block;
    width: 100%;
    padding: 14px; 
    border-radius: 6px;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    text-decoration: none;
    background:#0176ff;
    color:white;
    transition: background-color 0.2s;
  }
  .button-link:hover {
    background: #005ad1;
  }
</style>
</head>
<body>

<div class="box success-box hidden">
  <h2 id="final-message-title">游꿀 Avalia칞칚o Enviada!</h2>
  <p id="success-message">Obrigado! Sua avalia칞칚o foi registrada com sucesso.</p>
 먝
  <a href="https://sousaandrade.sharepoint.com/" target="_blank" class="button-link">Voltar para o In칤cio</a>
</div>

<div class="box main-box">
  <h2>Cursos Sousa Andrade Academy</h2>

  <form id="submissionForm">
        <input type="hidden" id="scriptUrl" value="https://script.google.com/macros/s/AKfycbw2VStVhvm7RgR6GchtLXpV2XE8hkX95GweWGLWkVIupz7gW0UH9DwUwLxmPrbbVLQ/exec">
   먝
    <input type="text" name="nome" placeholder="Seu nome" required>
    <input type="email" name="email" placeholder="Seu email" required>
    <input type="hidden" name="curso" id="curso">
   먝
        <div id="rating-section">
      <label id="course-label" style="margin-top: 0; margin-bottom: 10px; display: block;">Sua Avalia칞칚o do Curso:</label>
      <div class="rating-box">
        <input type="radio" id="star5" name="nota" value="5" required />
        <label for="star5" title="Excelente (5)"></label>

        <input type="radio" id="star4" name="nota" value="4" />
        <label for="star4" title="Bom (4)"></label>

        <input type="radio" id="star3" name="nota" value="3" />
        <label for="star3" title="Razo치vel (3)"></label>

        <input type="radio" id="star2" name="nota" value="2" />
        <label for="star2" title="Ruim (2)"></label>

        <input type="radio" id="star1" name="nota" value="1" />
        <label for="star1" title="Muito Ruim (1)"></label>
      </div>
    </div>

    <input type="hidden" name="status" id="status">
   먝
    <button type="submit" id="submitButton">Concluir</button>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const p = new URLSearchParams(window.location.search);
   먝
    // Elementos do DOM
    const form = document.getElementById("submissionForm");
    const courseLabel = document.getElementById("course-label");
    const ratingSection = document.getElementById("rating-section");
    const notaInputs = document.querySelectorAll('input[name="nota"]');
    const mainBox = document.querySelector(".main-box");
    const successBox = document.querySelector(".success-box");
    const finalMessageTitle = document.getElementById("final-message-title");
    const successMessage = document.getElementById("success-message");
    const redirectLink = document.querySelector(".button-link");
    const submitButton = document.getElementById("submitButton");

    const SCRIPT_URL = document.getElementById("scriptUrl").value;

    // --- Fun칞칚o Simples de Capitaliza칞칚o ---
    function capitalizeFirstLetter(string) {
      if (!string) return '';
      string = string.toLowerCase();
      return string.charAt(0).toUpperCase() + string.slice(1);
    }
   먝
    // --- 1. L칩gica para o Curso ---
    let cursoValue = p.get("curso");
   먝
    if (cursoValue) {
      // Formata o nome do curso para exibi칞칚o (ex: "curso_excel_basico" -> "Curso excel basico")
      let displayName = cursoValue.replace(/_/g, ' ');
      displayName = displayName.split(' ').map((word, index) => {
        return (index === 0) ? capitalizeFirstLetter(word) : word;
      }).join(' ');
     먝
      document.getElementById("curso").value = cursoValue; // Salva o valor original para o App Script
      courseLabel.textContent = `Sua Avalia칞칚o do Curso: ${displayName}`;
    } else {
      courseLabel.textContent = "Sua Avalia칞칚o do Curso:";
      console.warn("Par칙metro 'curso' ausente na URL.");
    }

    // --- 2. L칩gica para o Status (Iniciado vs. Conclu칤do) ---
    const statusValue = p.get("status");
    document.getElementById("status").value = statusValue || "";
   먝
    // Caso 1: Status "iniciado"
    if (statusValue && statusValue.toLowerCase() === "iniciado") {
      // Oculta a avalia칞칚o e exige apenas Nome/Email
      ratingSection.style.display = 'none';
      notaInputs.forEach(input => {
        input.removeAttribute('required');
      });
      submitButton.textContent = 'Iniciar Curso';
    } else {
      // Caso 2: Conclus칚o
      // Mant칠m a avalia칞칚o vis칤vel e obrigat칩ria
      ratingSection.style.display = 'block';
      notaInputs.forEach(input => {
        input.setAttribute('required', 'required');
      });
      submitButton.textContent = 'Concluir';
    }

    // --- Fun칞칚o para buscar a URL do curso (GET) ---
    async function fetchCourseUrl(courseCode) {
      const fetchUrl = `${SCRIPT_URL}?action=geturl&curso=${courseCode}`;
